{"version":3,"file":"EthereumTransactionDataEip1559.js","sources":["../src/EthereumTransactionDataEip1559.js"],"sourcesContent":["import * as rlp from \"@ethersproject/rlp\";\nimport * as hex from \"./encoding/hex.js\";\nimport EthereumTransactionData from \"./EthereumTransactionData.js\";\nimport CACHE from \"./Cache.js\";\n\n/**\n * @typedef {object} EthereumTransactionDataEip1559JSON\n * @property {string} chainId\n * @property {string} nonce\n * @property {string} maxPriorityGas\n * @property {string} maxGas\n * @property {string} gasLimit\n * @property {string} to\n * @property {string} value\n * @property {string} callData\n * @property {string[]} accessList\n * @property {string} recId\n * @property {string} r\n * @property {string} s\n */\n\nexport default class EthereumTransactionDataEip1559 extends EthereumTransactionData {\n    /**\n     * @private\n     * @param {object} props\n     * @param {Uint8Array} props.chainId\n     * @param {Uint8Array} props.nonce\n     * @param {Uint8Array} props.maxPriorityGas\n     * @param {Uint8Array} props.maxGas\n     * @param {Uint8Array} props.gasLimit\n     * @param {Uint8Array} props.to\n     * @param {Uint8Array} props.value\n     * @param {Uint8Array} props.callData\n     * @param {Uint8Array[]} props.accessList\n     * @param {Uint8Array} props.recId\n     * @param {Uint8Array} props.r\n     * @param {Uint8Array} props.s\n     */\n    constructor(props) {\n        super(props);\n\n        this.chainId = props.chainId;\n        this.nonce = props.nonce;\n        this.maxPriorityGas = props.maxPriorityGas;\n        this.maxGas = props.maxGas;\n        this.gasLimit = props.gasLimit;\n        this.to = props.to;\n        this.value = props.value;\n        this.accessList = props.accessList;\n        this.recId = props.recId;\n        this.r = props.r;\n        this.s = props.s;\n    }\n\n    /**\n     * @param {Uint8Array} bytes\n     * @returns {EthereumTransactionData}\n     */\n    static fromBytes(bytes) {\n        if (bytes.length === 0) {\n            throw new Error(\"empty bytes\");\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const decoded = /** @type {string[]} */ (rlp.decode(bytes.subarray(1)));\n\n        if (!Array.isArray(decoded)) {\n            throw new Error(\"ethereum data is not a list\");\n        }\n\n        if (decoded.length != 12) {\n            throw new Error(\"invalid ethereum transaction data\");\n        }\n\n        // TODO\n        return new EthereumTransactionDataEip1559({\n            chainId: hex.decode(/** @type {string} */ (decoded[0])),\n            nonce: hex.decode(/** @type {string} */ (decoded[1])),\n            maxPriorityGas: hex.decode(/** @type {string} */ (decoded[2])),\n            maxGas: hex.decode(/** @type {string} */ (decoded[3])),\n            gasLimit: hex.decode(/** @type {string} */ (decoded[4])),\n            to: hex.decode(/** @type {string} */ (decoded[5])),\n            value: hex.decode(/** @type {string} */ (decoded[6])),\n            callData: hex.decode(/** @type {string} */ (decoded[7])),\n            // @ts-ignore\n            accessList: /** @type {string[]} */ (decoded[8]).map((v) =>\n                hex.decode(v),\n            ),\n            recId: hex.decode(/** @type {string} */ (decoded[9])),\n            r: hex.decode(/** @type {string} */ (decoded[10])),\n            s: hex.decode(/** @type {string} */ (decoded[11])),\n        });\n    }\n\n    /**\n     * @returns {Uint8Array}\n     */\n    toBytes() {\n        const encoded = rlp.encode([\n            this.chainId,\n            this.nonce,\n            this.maxPriorityGas,\n            this.maxGas,\n            this.gasLimit,\n            this.to,\n            this.value,\n            this.callData,\n            this.accessList,\n            this.recId,\n            this.r,\n            this.s,\n        ]);\n        return hex.decode(\"02\" + encoded.substring(2));\n    }\n\n    /**\n     * @returns {string}\n     */\n    toString() {\n        return JSON.stringify(this.toJSON(), null, 2);\n    }\n\n    /**\n     * @returns {EthereumTransactionDataEip1559JSON}\n     */\n    toJSON() {\n        return {\n            chainId: hex.encode(this.chainId),\n            nonce: hex.encode(this.nonce),\n            maxPriorityGas: hex.encode(this.maxPriorityGas),\n            maxGas: hex.encode(this.maxGas),\n            gasLimit: hex.encode(this.gasLimit),\n            to: hex.encode(this.to),\n            value: hex.encode(this.value),\n            callData: hex.encode(this.callData),\n            accessList: this.accessList.map((v) => hex.encode(v)),\n            recId: hex.encode(this.recId),\n            r: hex.encode(this.r),\n            s: hex.encode(this.s),\n        };\n    }\n}\n\nCACHE.setEthereumTransactionDataEip1559FromBytes((bytes) =>\n    EthereumTransactionDataEip1559.fromBytes(bytes),\n);\n"],"names":["EthereumTransactionDataEip1559","EthereumTransactionData","constructor","props","super","this","chainId","nonce","maxPriorityGas","maxGas","gasLimit","to","value","accessList","recId","r","s","fromBytes","bytes","length","Error","decoded","rlp","decode","subarray","Array","isArray","hex.decode","callData","map","v","toBytes","encoded","encode","substring","toString","JSON","stringify","toJSON","hex.encode","CACHE","setEthereumTransactionDataEip1559FromBytes"],"mappings":"kKAqBe,MAAMA,UAAuCC,EAiBxD,WAAAC,CAAYC,GACRC,MAAMD,GAENE,KAAKC,QAAUH,EAAMG,QACrBD,KAAKE,MAAQJ,EAAMI,MACnBF,KAAKG,eAAiBL,EAAMK,eAC5BH,KAAKI,OAASN,EAAMM,OACpBJ,KAAKK,SAAWP,EAAMO,SACtBL,KAAKM,GAAKR,EAAMQ,GAChBN,KAAKO,MAAQT,EAAMS,MACnBP,KAAKQ,WAAaV,EAAMU,WACxBR,KAAKS,MAAQX,EAAMW,MACnBT,KAAKU,EAAIZ,EAAMY,EACfV,KAAKW,EAAIb,EAAMa,CACvB,CAMI,gBAAOC,CAAUC,GACb,GAAqB,IAAjBA,EAAMC,OACN,MAAM,IAAIC,MAAM,eAIpB,MAAMC,EAAmCC,EAAIC,OAAOL,EAAMM,SAAS,IAEnE,IAAKC,MAAMC,QAAQL,GACf,MAAM,IAAID,MAAM,+BAGpB,GAAsB,IAAlBC,EAAQF,OACR,MAAM,IAAIC,MAAM,qCAIpB,OAAO,IAAIpB,EAA+B,CACtCM,QAASqB,EAAkCN,EAAQ,IACnDd,MAAOoB,EAAkCN,EAAQ,IACjDb,eAAgBmB,EAAkCN,EAAQ,IAC1DZ,OAAQkB,EAAkCN,EAAQ,IAClDX,SAAUiB,EAAkCN,EAAQ,IACpDV,GAAIgB,EAAkCN,EAAQ,IAC9CT,MAAOe,EAAkCN,EAAQ,IACjDO,SAAUD,EAAkCN,EAAQ,IAEpDR,WAAqCQ,EAAQ,GAAIQ,IAAKC,GAClDH,EAAWG,IAEfhB,MAAOa,EAAkCN,EAAQ,IACjDN,EAAGY,EAAkCN,EAAQ,KAC7CL,EAAGW,EAAkCN,EAAQ,MAEzD,CAKI,OAAAU,GACI,MAAMC,EAAUV,EAAIW,OAAO,CACvB5B,KAAKC,QACLD,KAAKE,MACLF,KAAKG,eACLH,KAAKI,OACLJ,KAAKK,SACLL,KAAKM,GACLN,KAAKO,MACLP,KAAKuB,SACLvB,KAAKQ,WACLR,KAAKS,MACLT,KAAKU,EACLV,KAAKW,IAET,OAAOW,EAAW,KAAOK,EAAQE,UAAU,GACnD,CAKI,QAAAC,GACI,OAAOC,KAAKC,UAAUhC,KAAKiC,SAAU,KAAM,EACnD,CAKI,MAAAA,GACI,MAAO,CACHhC,QAASiC,EAAWlC,KAAKC,SACzBC,MAAOgC,EAAWlC,KAAKE,OACvBC,eAAgB+B,EAAWlC,KAAKG,gBAChCC,OAAQ8B,EAAWlC,KAAKI,QACxBC,SAAU6B,EAAWlC,KAAKK,UAC1BC,GAAI4B,EAAWlC,KAAKM,IACpBC,MAAO2B,EAAWlC,KAAKO,OACvBgB,SAAUW,EAAWlC,KAAKuB,UAC1Bf,WAAYR,KAAKQ,WAAWgB,IAAKC,GAAMS,EAAWT,IAClDhB,MAAOyB,EAAWlC,KAAKS,OACvBC,EAAGwB,EAAWlC,KAAKU,GACnBC,EAAGuB,EAAWlC,KAAKW,GAE/B,EAGAwB,EAAMC,2CAA4CvB,GAC9ClB,EAA+BiB,UAAUC"}